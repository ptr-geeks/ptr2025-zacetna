<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8">
  <title>Klikni gumb</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background-color: #eef;
    }

    #gameArea {
      width: 500px;
      height: 400px;
      border: 2px solid black;
      margin: 20px auto;
      position: relative;
      background-color: #ffffff;
      overflow: hidden;
    }

    .circle {
      position: absolute;
      border-radius: 50%;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .circle:active {
      transform: scale(1.1);
    }

    #startBtn {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      cursor: pointer;
    }

    #info {
      margin-top: 10px;
    }

    #leaderboard {
      margin-top: 20px;
      width: 300px;
      margin-left: auto;
      margin-right: auto;
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 10px;
    }

    #leaderboard h3 {
      margin-top: 0;
    }

    #leaderboard ul {
      list-style: none;
      padding: 0;
    }
  </style>
</head>
<body>

<h1>Klikni gumb</h1>
<p>Točke: <span id="score">0</span> | Naj rezultat: <span id="highscore">0</span></p>
<p>Čas: <span id="time">30</span> sekund</p>
<p>Naslednji krog v: <span id="nextSpawn">0</span> s</p>

<button id="startBtn">Začni igro</button>
<div id="gameArea"></div>

<div id="leaderboard">
  <h3>Lestvica najboljših</h3>
  <ul id="leaderboardList"></ul>
</div>

<audio id="clickSound" src="https://pixabay.com/sound-effects/computer-mouse-click-02-383961/" preload="auto"></audio>
<audio id="endSound" src="https://pixabay.com/sound-effects/beep-329314/" preload="auto"></audio>

<script>
  const gameArea = document.getElementById("gameArea");
  const scoreDisplay = document.getElementById("score");
  const highscoreDisplay = document.getElementById("highscore");
  const timeDisplay = document.getElementById("time");
  const nextSpawnDisplay = document.getElementById("nextSpawn");
  const startBtn = document.getElementById("startBtn");
  const leaderboardList = document.getElementById("leaderboardList");

  const clickSound = document.getElementById("clickSound");
  const endSound = document.getElementById("endSound");

  let score = 0;
  let timeLeft = 30;
  let gameInterval;
  let nextSpawnTimer;
  let isPlaying = false;

  let highScore = localStorage.getItem("highScore") ? parseInt(localStorage.getItem("highScore")) : 0;
  document.getElementById("highscore").textContent = highScore;

  let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];

  const ballTypes = [
    { color: 'red', size: 50, points: 1 },
    { color: 'green', size: 40, points: 2 },
    { color: 'blue', size: 30, points: 3 },
    { color: 'gold', size: 20, points: 5 }
  ];

  function randomPosition(max) {
    return Math.floor(Math.random() * max);
  }

  function spawnCircle() {
    if (!isPlaying || timeLeft <= 0) return;

    const type = ballTypes[Math.floor(Math.random() * ballTypes.length)];
    const circle = document.createElement("div");
    circle.classList.add("circle");
    circle.style.width = `${type.size}px`;
    circle.style.height = `${type.size}px`;
    circle.style.backgroundColor = type.color;

    const maxX = gameArea.clientWidth - type.size;
    const maxY = gameArea.clientHeight - type.size;
    circle.style.left = `${randomPosition(maxX)}px`;
    circle.style.top = `${randomPosition(maxY)}px`;

    circle.onclick = () => {
      if (!isPlaying || timeLeft <= 0) return;
      score += type.points;
      scoreDisplay.textContent = score;

      if (clickSound) {
        clickSound.currentTime = 0;
        clickSound.play();
      }

      circle.remove();
      spawnCircle();
    };

    gameArea.appendChild(circle);

    let secondsLeft = 1.5;
    nextSpawnDisplay.textContent = secondsLeft.toFixed(1);

    if (nextSpawnTimer) clearInterval(nextSpawnTimer);
    nextSpawnTimer = setInterval(() => {
      secondsLeft -= 0.1;
      nextSpawnDisplay.textContent = Math.max(0, secondsLeft.toFixed(1));
    }, 100);

    setTimeout(() => {
      if (gameArea.contains(circle)) {
        circle.remove();
        spawnCircle();
      }
    }, 1500);
  }

  function updateLeaderboardDisplay() {
    leaderboardList.innerHTML = "";
    leaderboard.slice(0, 5).forEach(entry => {
      const li = document.createElement("li");
      li.textContent = `${entry.name}: ${entry.score}`;
      leaderboardList.appendChild(li);
    });
  }

  function tryAddToLeaderboard(score) {
    if (leaderboard.length < 5 || score > leaderboard[leaderboard.length - 1].score) {
      const name = prompt("Vnesi svoje ime za lestvico najboljših:");
      if (name) {
        leaderboard.push({ name, score });
        leaderboard.sort((a, b) => b.score - a.score);
        leaderboard = leaderboard.slice(0, 5);
        localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
        updateLeaderboardDisplay();
      }
    }
  }

  function startGame() {
    if (isPlaying) return;

    isPlaying = true;
    score = 0;
    timeLeft = 30;
    scoreDisplay.textContent = score;
    timeDisplay.textContent = timeLeft;
    nextSpawnDisplay.textContent = "0";
    gameArea.innerHTML = " ";
    startBtn.disabled = true;

    spawnCircle();

    if (gameInterval) clearInterval(gameInterval);
    gameInterval = setInterval(() => {
      timeLeft--;
      timeDisplay.textContent = timeLeft;

      if (timeLeft <= 0) {
        clearInterval(gameInterval);
        clearInterval(nextSpawnTimer);
        gameArea.innerHTML = " ";
        isPlaying = false;
        startBtn.disabled = false;

        if (endSound) {
          endSound.currentTime = 0;
          endSound.play();
        }

        if (score > highScore) {
          highScore = score;
          localStorage.setItem("highScore", highScore);
          highscoreDisplay.textContent = highScore;
        }

        tryAddToLeaderboard(score);
        alert(`Konec igre! Dobil si ${score} točk.`);
      }
    }, 1000);
  }

  startBtn.onclick = startGame;
  updateLeaderboardDisplay();
</script>
</body>
</html>